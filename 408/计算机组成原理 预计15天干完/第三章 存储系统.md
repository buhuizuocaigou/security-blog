主要针对存储器方向做细节探究  
## 存储器的基本概念 ：
![[Pasted image 20240722164304.png]]
分类 细节 考察  
必须将 内容读取到主存中 才可以进行使用   
cache （高速缓冲存储器 ）目的是缓解速度矛盾 
：作用  是加入 cache来让 他 从主存当中复制一份过来 ，相当于是cache 的时候追赶到cpu的速度 主存中的内容 速度不够 跟的上cpu的速度 故采用这种操作进行 

寄存器 ：存放东西的寄存器  ：
硬件 +操作系统进行协同操作  并且  考虑   
主存跟chace 中数据交换是 考虑到  硬件  的 交换数据的渠道 
主存到辅存：虚拟存储系统：解决了存储容量不够的问题 
同等容量下  chache 的话 成本比主存的要大得多 

高速缓存跟 主存可以直接被cpu读写 
辅存必须到主存后才可以直接被cpu读写 
存储介质：     
1 半导体存储器 ：主存 chache  
2 磁表面 的存储器 ：磁盘磁带 作为存储器 
3 光存储器 ：光介质为存储信息 

存取方式：
1 随机存取存储器 RAM 速度比sam快得多但是存的少：读写任何一个存储单元所需时间相同  并不会因为存放的位置而发生变化 
每个人都平等对待    存取时间与存取的物理位置无关 
2.ROM 只读存储器 一旦将数据存入内部将不会丢失 但是 数据只能随机读入 不能写入  
均为随机读取   


2 顺序读取存储器：SAM ：读写一个存储单元所需时间取决于 存储单元所在的物理位置

3直接存取的存储器：DAM：直接选取信息所在区域然后按顺序方式进行读取  既可以顺序读取又可以按顺序存取 
先找到一个指定的小区域的数据后再在指定区域上进行读写 顺序读写等 

4相连存储器：CAM  按照内容检索存储位置进行读写 快表就是相联存储器 的内容 （按内容访问）



信息可更改方式：
1 读写存取器：读写均可  磁盘  内存 chache   可以读 也可以写 

2 只读存储器 ：之鞥呢读 不能写   比如 实体音乐  （ROM）中可以多次读写  BIOS  先擦除在写 等 



信息可保存性 ：
1 易失性存储器 （主存、Cache）:断电完后就gg了
2 非易失性存储器（磁盘、光盘 ）：断电后依旧保持原样进行  


信息读出后  存储信息被破坏 ： 破坏性读出  DRAM芯片  读出数据后 需要进行重写  阅后即焚
信息读出后 原存储信息不会被破坏 ：非破坏读出：SRAM  芯片 磁盘 光盘       

存储器性能指标：1存储容量 ：存储字数x字长 MDR位数反映了存储字长是多少    
                 2 单位成本  ：每位的价格=总成本/总容量    每一个bit位付出的成本是多少 
                   3存储速度：数据传输率  =数据宽度/存储周期  =   d/T=v
                   数据宽度=存储的字长 计科   


![[Pasted image 20240722170807.png]]

## 主存储器的基本原理
半导体的元器件：
![[Pasted image 20240722171116.png]]
MOS管：用电控制的开关  输入 高电压的话  ：MOS可以导电 导通  
如果 电压达不到5v的话他是不导电的绝缘体  
电容 ： 电容 是金属板组成 .且  给电容充电的过程  产生一个移动的过程 

电容保存为有电荷的时候保存为1        
如何读取呢 ： 给mos 一个 1   给5v  后 mos 可以接通  相当与电压届通开始导电进行 成功导电 进行电路相当于开关接通了  

![[Pasted image 20240722171633.png]]
存储单元   
原理如上述图  


存储字长是 8bit 且 存储单元如上图所示 其 属于存储体  
![[Pasted image 20240722171719.png]]

译码器 ：根据地址决定读取那个 翻译成  那条红色线路 
MAR给的 提示的二进制数据是给出了 第几根 地址    
第几根线   也就是相当于是第几根数据线         
![[Pasted image 20240722172005.png]]

![[Pasted image 20240722172214.png]]

译码器 ：控制 存储器 的开或者关  
详细 了解 读写线 ：chatgpt 

![[Pasted image 20240722172453.png]]


![[Pasted image 20240722173021.png]]

线氛围  地址线 +数据线 +片选线 +读写控制线（2 or 1根  ）

## SRAM跟 DRAM 

RAM ：随机访问存储器 ：指定特定存储地址  该地址的存储速度不会因为物理地址盖板 Sram 是静待ram 
DRAM   跟 SRAM 的对比是啥 （高频考点）：
DRAM 是珊极电容    SRAM是双稳态的触发器 
电容器 ：1 电容内存储了电荷 
    DRAM:      2  电容内为存储电荷 
              其中电容器中 0 表示无电荷   而1表示出有电荷并且数据线上 有电流放出  
          
因为是电容放电 所以一旦放了以后就无法再恢复 所以 他是 破坏性读出  也就是阅后即焚
解决方案：重新给电容充电就好 ，





SRAM:  是双稳态触发器 ： 是有6个mos管  的       双稳态 ： 1 A高 B低  ：显示的是1 
                                                 2  A低 B高 显示的是0  
![[Pasted image 20240722190141.png]]
在该电路图中  BL 跟BLX如何确定是否为高低电平 答： 当 其双稳态中 哪边是低哪边就是低电平  这个原理 


读出数据：触发器保持稳定 且是非破坏性读出 无需重写的过程  

左侧的存储的成本更低 但是右侧的是  成本高 容易保存信息 既可循环利用信息的过程 
![[Pasted image 20240722190528.png]]
出现了以后 脑子里想上面这个图即可 
注  不管是 SRAM 跟DRAM而言都是      易失  性存储器 （内部不提供电源或者存储电源的容器 导致的 ）
SRAM(双稳态触发器) 因为是  运行速度非常快，导致存储成本高  并且存入到 cache到高速缓存的系统中   
速度快 导致 可用于cache中 

  然后 DRAM（单数据栅极电容 其） 电路图比较小 导致 其存储容量显著提高 常用语主存中  
速度慢导致但是存昂的信息多 因为体积小导致 集成度高  从而可以用于主存当中 牺牲速度换来的 


如何给DRAM进行刷新工作？既多久刷新一次？
刷新周期 ：2ms 
每次刷新多少个存储单元 呢 ：以行为单位进行刷新  一次刷新一行单元 


当译码器 进行拆解后  可以采用 行地址译码器跟 列译码器 形成了 一个矩阵的形式进行拆解的过程  
这样 通过减少 线的条数减少导致   行列译码器 

地址拆一半 前半拉给行地址译码器  
后半拉给列地址译码器  取行列的交集  即可 行列的交集 即可  一行一列形成矩阵进行读写即可 
如何对行列进行刷新： 有硬件支持 读出一行信息后重新写入（读一行写一行 ） ，并且占用一个 读/写周期 
什么时候刷新呢？  
   读写周期=存取周期    

思路三 ： 异步刷新 ：
合理利用时间  2ms 的情况下   ![[Pasted image 20240722192141.png]]
第三个是异步刷新  就是 跟操作系统调度中的异步性 一样  
SRAM ：线多 所以分两次送  为了让 芯片减半  同时送 一次送完行跟列地址      
DRAM ：线少 只能一个一个送  DRAM 是分两次送  地址线复用技术   地址引脚数目减半！！！！！！
DRAM 刷新是独立完成 不需要cpu的介入跟控制  
DRAM =
现在 采用的 是 sdram 这个系统 

什么是ROM 只读存储器：
rom是 非易失性 ：断电后 数据不会丢失  

名词解释
MROM：掩模式只读存储器 ：只读不能存储器  任何人不可能重写   初始化根据厂家 完成 只能读 不可以写 任何人不能进行重写技术
只适合批量定制。
PROM ： 可编程的  是写了一次就不允许 更改  只能用一次 写入一次性 产品  到那时随便读 

EPROM ： 可擦除的可编程 的只读存储器
允许用户写入信息 ，并且可以进行多次重写      
UVEPROM  ：紫外线 照射就可以擦除==所有==信息 
EEPROM     是擦除特定的信息 。电擦除的信息 并且可以擦除特定的字信息 
Flash Memory ：闪存 存储器 是u盘跟 sd卡是闪存 是写入  闪存 写 比读慢  闪存 的话 可读可写  
归为只读类 因为 读比写快得多        存储元 只需要单个的MOS管   位密度的话 RAM 的高
位密度指的是在单位的信息的情况下 闪存存的AV 比  别的存储的 AV片多

SSD 固态硬盘  是 控制单元+FLAsh芯片 固态硬盘 ：因为内部有个控制器   机械硬盘造价比固态硬盘的是低 
手机的辅存是 flash的戒指  比ssd的集成度高    手机芯片因为 
闪存可以读写  因为读比写快  所以是 ROM 依旧是 ROM   

计算机内部 重点 的 ROM 的芯片 
主存断点就没了  

操作系统是 安装在辅存里面  
就跟开车 刚开始打火花一样 得先 通电打一个小火后面才能 动起来
CPU开始的时候   啥指令没有 ，得从一个地方 先取指令  
这个是主存里面 的一部分 叫做 BIOS  就是开机前  主存啥指令没有的时候就 往里加载 的话  第一波指令 就是 从bios加载    

写的速度比读的要慢 因为写的要先擦 所以慢的多  
很多的rom有随机存取的特性
DRAM  的是 读的快 但是 恢复 时间贼慢  

双端口RAM （了解就好不在408大纲内）：两组各种独立的线 并且是更复杂的设计 进行  
俩cpu 读写的竞争的问题  
不能同时写入  不能对同一个数据进行同时读写   竞争么  这形成了竞争 

 解决方法 ：进行延时访问操作  的问题 
 




多模块存储：重点了解！！！！！！！！！！！！！！

 高位交叉编址 的多体存储器    低位交叉编址寄存器 
 采用cpu中的地址的高位 bit位置来区分 几个内存条     到底要去哪个内存条 

低位交叉编制     对于给定的内存地址 会用更低位的交叉编址进行存储 ：

比如 00  001  表示的是 00代表的是第几个内存条  后面001代表了是第几个格子的值 
体号  体内地址  
页号 页内地址  
段号 段内地址  


![[Pasted image 20240722195850.png]]
左边竖着存 右边横着存 

假设存取周期 T=4r    其中一个存取周期是3r 也就是被分解为 r+3r的分析解析 
![[Pasted image 20240722200319.png]]
去恢复的时候是针对整个 M0  跟 M1 进行的恢复操作  还有读写操作  
操作系统调度  两种作业方式 
M0 恢复的时候  是影响整个M0 这一竖排 的 刷新影响这一竖条   的  结果   宏观上读写 的话 接近r
当 足够大的时候 低位交叉编制的话 是多体 并行存储器
连续存储的单元的话  是程序的指令的存储方式  
操作系统中的     并行作业 并行调度作业行为 
应该取几个体呢 ？得提供多少个水平的内存的条呢 ？
![[Pasted image 20240722200824.png]]
打工人  啊 打工人的刚好  那边 把r结束后    总线传输周期 相当于 数据总线传给cpu需要多长的时间  时间不可能低于R  
刷新影响这个 “条"
单体多子  一行 存m个字 总线宽度 的是 m个 一次并行读取m个字      ！！！！！！！！！！！！！！

## 主存储器与cpu的链接 

单块儿的存储芯片与CPU的链接   
如何扩展主存的字数呢？ 字长只有8bit的数据  但是如果存放64bit我该怎么处理呢 
这个  数据总线的宽度=存储字长   的话  64bit  位扩展 
数据总线宽度 >存储芯片字长  位扩展  
![[Pasted image 20240722222612.png]]
注意此图形的书写方式    MDR 是存放数据的信息  MAR是存放地址的信息  

当出现多快存储芯片  如何与cpu进行连接呢？
![[Pasted image 20240722222822.png]]

注意是否有横线 即可 
注意地址总线跟 数据总线的 区分 方式     
![[Pasted image 20240722223234.png]]

这个 红色的代表的是地址总线  而绿色的代表的是数据总线的内容 


字扩展 “![[Pasted image 20240722223905.png]]





多块儿的 芯片与CPU连接  位扩展  字扩展  字位扩展 
![[Pasted image 20240722224211.png]]

1-2 译码器  是输入 1个信号输出2个信号  

![[Pasted image 20240722224954.png]]



补充  关于译码器的使用 ！！！！！

3-8译码器 ：

![[Pasted image 20240722225656.png]]
这个玩意儿，使能信号是负责 管理译码器是否能不能懂的  
地址信号的稳定后 发出存储器的请求信号的   
![[Pasted image 20240722230147.png]]
74ls138 输出端 输入端 3-8 端口 3个使能 记得这个型号的 


RAM 的读写周期 ：


### 3.4外部存储器
外存储器：
![[Pasted image 20240724143939.png]]

外存储器称为辅助 存储器 目前主要使用的是磁表面存储器 
所谓的磁表面存储器 ：指的是把磁性材料屠宰 金属铝作为载体 来存储信息。 磁盘存储器 磁带存储器 跟磁鼓存储器 都属于磁表面存储器    
他的划过 的时候  永久保存 读线圈 可以 1bit 1bit的读取跟写入数据信息 
并行输入的电路 串行 输入 到  读   
注意 磁表面存储器 同时 读写 不可同时进行 ，并且 只能1bit 1bit的读写 

![[Pasted image 20240724144315.png]]
注意对工作环境要求比较高     不能放到强磁场的环境下 容易受到他们的干扰部分 


![[Pasted image 20240724144453.png]]
大概长这个模样  ，   
磁盘 设备的组成 ：
1 存储区域  ： 磁盘多个记录面，一个及路面若干磁道 ，每个磁道划为多个扇区，扇区称为块儿 是磁盘的读写的最小单位 
名词 解释：磁头数：记录面数  就跟黑胶唱片机一样，一个光盘上面有多少个读写移动臂的内容 。就有多少个磁头，磁头读写盘面上记录面的信息 一个记录面对应一个磁头 ，既一个光盘对应一个机械臂记录信息的磁头
2 柱面数：每个盘片分为多个同心圆环，且这些圆环称为磁道(Track） ,这些环 一圈一圈的同心圆被称为磁道，然后所有盘相同半径的磁道组成同一个柱面
为什么要引入柱面数这个概念？
	1 组织数据：是让数据在硬盘的组织更加的系统规范化，通过将所有盘片上同一个磁道归结为一个柱面，数据可以在多个磁头之间协调读取跟写入，提高数据存储的一致性 进行多磁头写入
	2 简化寻址 早期硬盘的CHS（柱面-磁头-扇区）的寻址模式是常见的做法 ，通过柱面数 磁头数 扇区数 三者确定物理存储位置 
	 3切换效率高 ：在柱面之内移动的速度相对来说比在 不同柱面之间移动的速度要快的多 
  3扇区数：一个扇形的区域 ，以盘片为圆心 以某种角度为夹角进行 划分  
            磁道的扇区数  每个磁道上面有多少个扇区    
    一次读是按照扇区 去读  写    扇区 就是 统计图中的一个 小披萨的角   
磁盘存储器=磁盘驱动器+磁盘控制器+盘片组成

磁盘驱动器 ：存储跟检索数据的设备 分为多种类型例如：硬盘驱动器，固态驱动器 ，官潘驱动器等   
磁盘控制器 ：磁盘存储器跟主机的接口 ，主要是相当于存储跟检索数据的一个大脑形式 
主流标准：IDE  SCSI SATA等 
IDE：PATA：早期的磁盘控制器标准实现并行传输 速度低 
SATA：常用语HDD 跟SSD ：提供较高的传输速率跟可靠性 的问题
SCSI ：企业级的存储设备 ，具有高性能跟多任务的处理能力，支持并行跟串行传输  如SAS等 
其实长这样：
![[Pasted image 20240724150344.png]]
 
2 磁盘性能指标：
	 1 .磁盘容量 ：能存储的字节总数  
	 分为  （1）非格式化容量：原始容量 指的是存储设备在未经过任何文件系统格式化之前的总的存储容量，厂家出厂的时候的 未经处理前理论能存多少东西   最多能装多少东西  没有任何文件系统跟分区 
	      （2）格式化容量：表示存储设备经过格式化后，可供用户存储问价你跟数据的实际容量，反映了存储设备建立文件系统结构的有效的存储空间  
	      格式化过程：分区 文件系统创建  元数据管理等等 会产生默认占位置的容量  
  
     2 .记录密度:单位面积记录二进制的信息量= 道密度  位密度 面密度 
          道密度：指的是在半径方向上的单位长度的磁道数  
          位密度：磁道单位长度上能记录的二进制代码的位数 是一圈的二进制代码的位数  
          面密度：位密度x面密度
          注：磁盘中所有的磁道 在一个扇区内，不管是最外圈还是最内圈 其存放的数量是一样的存放的信           息量一样 也就是单位长度上 在一个扇区能塞下那么多东西
          所以 每个磁道的位密度是不同的 内圈信息量大 导致位密度大  而外侧的信息量少导致位密度少
    3 平均存取时间：= 磁头先移动到 目的的磁道（寻道时间）较长（会给平均时间）+旋转延迟时间 旋转光盘 旋转延迟时间（默认取一个转半圈的时间）  +传输时间 （传输数据 也就是数据信息全部划过这个磁盘的时间）+磁盘控制器的延迟时间  接受cpu的延迟需要时间 延迟 
    
      4 数据传输率：单位时间内向时间诶向主机传输数据的字节数 也就是数据传输率  
      磁盘转速r转/秒   每条磁道的容量是N 个字节 则数据传输率是 Dr=rN 
      
  
3主机如何能找到 我到底该去哪个扇区的  
磁盘地址 ： 地址结构：
分为如下 几部分：驱动器号    柱面磁道号    盘面号   扇区号 
4磁盘的工作过程：
  磁盘操作先寻址 定位到刺刀  度盘 谢攀       每一个操作都对应一个控制字   磁盘工作时候 第一步取控制字 第二步是执行控制字，
  磁盘属于 机械部件 是串行 并且 不可能子啊同一个时刻进行读写 不可能在同一个时刻读写两组数据或者写两组数据  
  

磁盘阵列：
RAID ：廉价的冗余磁盘阵列 ：通过物理磁盘 一堆串行的数据后  将多个物理磁盘穿串行 组成独立的逻辑盘 

磁盘是慢速的 设备 采用 方案是 类似与低位交叉编制的多体存储器   这种思想或者思维方式 
![[Pasted image 20240724153225.png]]
将只能串行的 磁盘 在物理上 通过某些处理 上 这样 采用 的类似与低位交叉编制的逻辑处理方式 来达到 并行 的目的 
RAID0--RAID5：

![[Pasted image 20240724153404.png]]
RAID0:无冗余指的是 没多余数据 没备份 无校验 不知道 这个数据的是否正确以及准确性是啥 不知道 

RAID1：复制了一份 
RAID2：什么是海明校验码：为了可以海明校验码 云计算 ！ 一个bit放一个块儿 

![[Pasted image 20240724153623.png]]
RAID0 是无容错能力 
RAID1 是 复制一份引起的 容量少一半 
减少成本 

固态硬盘 SSD 的信息：
![[Pasted image 20240724161325.png]]
总结的大纲 ： 
 固态硬盘
 原理：基于闪存存储技术的存储设备 没有机械运动部件 电可擦除的rom eeprom
电可擦可编程只读存储器 ：控制ssd工作逻辑的程序代码，包括数据读写管理 ，错误纠正等，磨损均衡等，垃圾回收等功能。
存储后断电依旧可以保留
（2）存储配置跟校准诗句： 可以存储ssd的配置数据 存储介质的校准信息 出厂配置跟其他参数
信息在ssd启动的时候读取，并且用于初始化跟校准ssd的操作行为 
3存储日志： 存储日志信息等   同时其存储容量比较小 并且可以电可擦除编程  
组成：
（1）：闪存翻译层 FTL  是ssd控制器中的一个关键组件，常用在管理数据跟子啊逻辑地址以及物理闪存地址之间的映射，且FTL的作用是将主机系统看到的逻辑块儿地址 LBA转换为实际的物理存储单元的地址 进行高效的数据读写管理
闪存翻译层FTL的作用：
1。 地址映射：维护映射表  这种映射允许 使用逻辑地址访问数据 但是实际粗糙农户位置有ftl管理
2 磨损均衡  使得写入操作均匀分布到所有的存储单元中  
3坏块儿管理：通过nand闪存中管理物理损坏的块儿进行管理 避免数据写入 
4错误校准： 就是利用错误校正码 来纠正数据错误 

类型：1 页映射  映射到物理页中，并且提供一个空间利用跟随机写的技能
2 块儿映射 ：
3混合映射 动态映射

存储介质：1 NAND闪存：存储单元 是釜山晶体管  页跟块儿进行存储   其中一个页 是4kb-8kb 一个块儿由多个页组成  
2 数据只能按照页写入 但是必须按块儿擦除  写之前 先进行擦除  
SSD 通常配备 dram缓冲机制 


读写技能特性：
1 以页为单位进行写  但是擦除以块儿 为单位  
2 擦除前 页只能写一次 但是读随便读 
3支持随机的访问 性能 ：并且速度特别快 延迟低 并且可以同时处理并发 不用像机械硬盘一样必须读取磁盘上的磁条来体现性能 的高低 
4 恢复跟读写速度快
5 当读写的时候必须进行 后台垃圾回收 ，不影响前台的操作  目的是回收整理已经删除但是未实际擦除的页腾出空间 
并且提升存储效率 ，在回收的过程中 将其原有的块儿借助第三方  存放后进行擦除 在进行覆盖 
这样效率提升 但是操作数提高 




固态删除 问题的额访问 
固态 来说 逻辑块儿号 对应的 逻辑地址进行删除    也可以写一次 读无数次
写 的时候得需要第三方介入  并且可以 进行随机访问的情况  
固态支持随机访问 直接从逻辑地址映射到物理地址 的话     机械的话得移动此笔 有存到
固态一个块儿 擦除次数 跟写入过多 的haul可能会坏掉 有一定概率损坏  
机械 硬盘不会写入次数 多 坏掉

机械硬盘 相比的特点 ：
1 除了速度快 随机存取等  特点 重点是 ssd当中反复擦跟写 同一个块儿 的话 会坏掉 



固态引入磨损 均衡技术 ： 平均到没每个块儿的磨损上 
动态磨损均衡 ：优先选择累计擦除次数少的新闪存块儿
静态磨损聚恒 ：ssd监视并自动进行数据分配让老的 承担主的   新的 承担写入的功能

Cache---主存的体系机制
通过在cpu跟内存之间介入 Cache的机制来达到 高速缓存的机制以用来帮助  高速视频存储 进行更高的配合 cpu的工作 
现在cache 跟cpu集成在一个框内进行的 
集成度 体积 不太行 不咋地 

虽然c语言是二维 但是在内存中集中访问的是 一维数组进行访问的 
句不习惯
cache的空间局部性原理：数组元素 顺序指令 指令
指的是访问cpu的过程中  
在进行访问的过程中  空间局部性揭示了 当 某一个块儿被访问后 其周边的邻居有可能接连被访问，就是说一个块儿被访问 后连带其他的 可附近的存储位置 都可以被访问 ，这样子可以充分利用存储空间进行存储操作  就爱你好骚访问ram的次数 ，可以先把数据读取到cache里面提升效率 
cache 的时间局部性 ：最近未来可能即将要用到的信息可能是最近正在使用的信息  循环结构的指令代码  

提前复制  速度快的多 这样 让 chache直接可以跟cpu进行联动操作 

性能信心：
命中率 H 是cpu在cache的命中率  cpu与访问的信息 在Cache的命中率  cpu能在cache找到该数据的信息的概率是多少 
缺失率：缺失率指的是 主存的平均访问时间 t 
分两部分  一部分 是用H 的先去cache 找    无论找不的到 的话 再去主存里面找 花tm的时间
![[Pasted image 20240724171851.png]]
采用两种方式 ：
1采用的是先访问cache 再访问主存 
所以 对于其性能提升 
有    命中率x只访问cache的时间+未命中率x （访问cahce+主存的时间）：我先去找cache 没找到 然后再走访问主存那条路 
2 当采用cahche跟主存同时进行的时候 
命中率x 访问cache的时间 +未命中率x 访问cache的时间 即可 


如何界定周围呢 ：是以块儿为单位进行数据的交换 进行交换数据的过程的 
![[Pasted image 20240724173433.png]]

存放页内地址 有一部分  
有另外一部分存放的是 块儿号 来存放  以块儿为单位进行数据交换的 
当访问的主存快后 立马调用到cache 中      
如何 记录cache 跟 主存的 映射方式是啥呢 
chache很小 主存的容量大 怎么处理呢 
如何保证 副本跟 本体一直   
当我们修改的时候  如何做到同步 的一致性呢 ？


### chache 如何区分cache 跟主存的映射方式呢?
大概的磁盘存放方式如下：
1 ![[Pasted image 20240724194219.png]]
这是本节中三个 的存放的空间大小 
其中第一个全相联映射的时候  
除了配标记外 还应该配一个有效位 放进去   同时在陪一个相应的标记 位 

一共直接映射访问  且cahche 一共几行 是2的几次方行后 （因为只能用01010表示 ）
2路组相连映射 2块儿为一组 ，分四组
![[Pasted image 20240724201316.png]]
注意有一个有效位 的同时还有一个 标记位   注意其 位数的区分   的问题  
根据多少位  不用取余 根据分组不同或者取余chache的不同  来根据2进制 的010100101 
来判断具体应该存放到哪里 

全相联     直接映射  组相连映射  n路组相连映射  n个cache行为一组   
如何拆分 的呢   

### Cache 的替换算法 ：
当cache 的时候装满了  该咋办呢 
全相联映射 ：
当只有cache 全装满了才需要替换   
直接映射方式：
当发现有数据了 直接换掉就可  
组相连 映射方式：
当 某映射块儿 所在分组的 里面 全满了 就 替换  
跟操作系统的磁盘调度算法一模一样 
### RAND替换算法 ：
当cache已经满了 。则随机选择一块儿替换即可 ，

![[Pasted image 20240725161311.png]]
想换哪个换哪个 
FIFO先进先出  ：火车头算法 : 有一个隧道，cahce  从0开始进入隧道，进一个走一个 一共这个隧道能放指定cache个  然后 按照进入速度 谁先进隧道 谁就 先出去  然后 后面进入的加入到火车尾 

![[Pasted image 20240725161659.png]]
未考虑到 局部性原理  
抖动现象 ：频繁地换入换出 刚被换出马上被调用  
近期最少使用  LRU算法  
为cache 设置一个计数器  记录 cache 到底哟多久没有被访问了
当cache满的时候，替换 这个计数器最大的即可 
站在当下往前看 ，谁离得远优先换谁  

硬件 设置  如何做的 
给每个 硬件   cahce行 有    三个标记为  一个是标记位  一个是 标志 位  
另一个是 计数器位 规则如下：
1：核心规则 ：离得最近的计数器最小  最近命中的立马清零  每访问一次 加以一

谁摸鱼时间最久先置换谁 

  核心 的话 计数器  是 cahce块儿的总数是2的n次方的话 计数器需要n位 且cache装满后所欲计数器的值一定不重复  
  11 两位信息表示四位的值  
  依据局部性原理  实际效果优秀 cache命中率高 

### 最不经常使用算法  ：
设置计数器  然后 
高被访问多少次   。就是 计数器的访问次数  
按照 访问次数来规定 而不是 距离远近  

当出现两种 多个计数器 最小的行  可以有两个策略：
策略一 ：按照行号递增 的规则 
策略二：FIFO策略进行选择递进 
谁闲置越久  先用谁  
LFU 的算法 曾经被经常主存块儿的块儿 未来并不一定会被用到  如微信视频聊天的凯尔 并没有很好的遵循局部性原理，实际运行效果不如LRU  

### Cache写策略：
修改副本后 如何保证 一致性 也就是 如何让他们俩保持一致的原理呢 

写命中 里面呢：
写回法：
![[Pasted image 20240725163947.png]]
就是当主存中发生冲突的时候,  先修改 cache中 当下冲突的主存的信息即可，修改一部分信息 ，不往主存里面去改，此时 cache中的信息 跟主存中对应的存储的信息发生冲突，当被修改过的cache 需要替换的时候才会跟主存中对应的 块儿信息进行互相替换，也就是说 如果跟他不相关，的主存块儿的信息 将不会受到任何干扰

系统为了 辨识这些 引入了一个脏位的东西  标记为1的时候 表示cahce经过修改  表示cahce是否被修改过 

全写法写直通法  
：
![[Pasted image 20240725164555.png]]
思路如下：
同时cpu对cache 跟主存进行 写入操作，进行修改，然后 不用进行cache 跟 主存之间的同步操作，但是会出现一个问题，cpu访问主存太慢了  访问cache 的速度远远比访问主存中的速度快的多 
所以引入一个写缓冲机制  采用SRAM实现  其中在写缓冲内部，cache 一旦被修改 先放入写缓冲中  修改一个放进去一个 ，当写缓冲 有的时候 与此同时 采用另外一种控制电路 慢慢悠悠的 将写缓冲的数据输入到主存当中进行修改 ，在进行修改的时候 同时跟cahce跟写缓冲进行同步 


写不命中 ：
写分配法：当cpu对cache 没命中的时候   把主存中 的数据调入 到 cahce 中 进行   复制到cache中  通常与写回法配合使用 

非写分配法：  cpu对cache 写不命中的时候  字节写入主存   
全写发搭配 


多级cache  ：分为 L1  L2  L3  三级缓存  
更高级的cache 的是保存部分的 


各级cahce 的之间 全写法 跟 飞鞋分配法    
## 虚拟存储器 2个小时42分钟 
顺一遍！ 顺一遍思路 即可 
cache 虚拟存储系统  tlb 串联起来  
虚拟存储器 整个大概的梳理是啥 ：
关键知识扫盲： 1 主存地址中 的EA：指的是实际地址的存放位置跟空间大小，实际存在的地址 
2 MMU 内存管理单元 
找页表 来找段表  来 寻找到最终的物理地址  mmu转换后并且输出为 PA  信号 输出到下一个单元位置中 。。。
寻址方式中是人为进行规定的东西 的内容 
慢表是 表象 是页表的转换器 通过段号黄钻韩城页表 的机器 


TLB跟mmu以及  跟最终主存中慢表的 交互相当于是
把tlb象征等同于cpu 与主存之间通过的cahce 之间一样 ，当 cpu需要访问存储信息的时候，先去访问的是 Cache 界面 如果cache里面调用不到 找不到适合cpu去访问的信息的话，就 cpu去磁盘里面找 
同理mmu先去tlb找到对应的页--表映射地址机制  如果在tlb里面找不到的话 那就直接去主存当中 去访问慢表 


实际中 是 同时查 还是 分开先后顺序查 是题目中会告诉你 该怎么去做 

慢表不可能 不命中 他是内核的数据结构  
操作系统内核不会允许查不到man表发生 的

明天上午8-10 干一件事  画图  ：画这上面的八张图 ，划清楚   在做题  
必拿下！























补充知识 主存储器跟cpu之间的链接 
分为 数据总线 跟地址总线  
其中 链接原理如下:
1 主存储器通过数据总线地址总线 跟控制总线与cpu链接 
2 数据总线的位数跟工作频率的成绩 正比与数据传输速率 
3 地址总线位数证明了 可寻址的最大空间是多少 也就是说最多可以出去多少个地址 
4   控制总线  读/写 证明了 总线周期类型 以及 本次输入输出的时刻 

